<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Analysis: The Patent Registration Process</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Libraries for reading DOCX and PDF files -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mammoth/1.4.18/mammoth.browser.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@700&family=Vazirmatn:wght@400;700;900&family=Lalezar&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Vazirmatn', sans-serif;
            background-color: #f4f1eb;
            /* Subtle noise background texture */
            background-image: url("data:image/svg+xml,%3Csvg width='6' height='6' viewBox='0 0 6 6' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='%239C92AC' fill-opacity='0.1'%3E%3Cpath d='M5 0h1L0 6V5zM6 5v1H5z'/%3E%3C/g%3E%3C/svg%3E");
            color: #333333;
        }
        .font-heading {
            font-family: 'Lalezar', cursive;
            letter-spacing: -0.02em; /* Tighter letter spacing for display font */
        }
        /* Improved readability for paragraphs */
        p {
            line-height: 1.75;
        }
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
            height: 350px;
            max-height: 450px;
        }
        @media (min-width: 768px) {
            .chart-container {
                height: 400px;
            }
        }
        .tab-button {
            transition: all 0.3s ease;
        }
        .tab-button.active {
            background-color: #4a5568;
            color: #ffffff;
            border-color: #4a5568;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        .explain-term {
            cursor: pointer;
            border-bottom: 1px dotted #9ca3af;
            transition: border-color 0.3s ease;
        }
        .explain-term:hover {
            border-bottom-color: #333333;
        }

        /* New Custom Loader */
        .custom-loader {
            width: 50px;
            height: 50px;
            display: inline-block;
        }
        .custom-loader svg {
            animation: rotate 2s linear infinite;
        }
        .custom-loader .circle {
            stroke: #3498db;
            stroke-width: 4;
            fill: transparent;
            stroke-dasharray: 157;
            stroke-dashoffset: 0;
            animation: dash 1.5s ease-in-out infinite;
        }
        @keyframes rotate {
            100% { transform: rotate(360deg); }
        }
        @keyframes dash {
            0% { stroke-dashoffset: 157; }
            50% { stroke-dashoffset: 0; }
            100% { stroke-dashoffset: -157; }
        }

        /* Fade-in animation for sections */
        .fade-in-section {
            opacity: 0;
            transform: translateY(20px);
            transition: opacity 0.6s ease-out, transform 0.6s ease-out;
        }
        .fade-in-section.is-visible {
            opacity: 1;
            transform: translateY(0);
        }
    </style>
</head>
<body class="antialiased">

    <!-- Modal for Explanations -->
    <div id="explanation-modal" class="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center p-4 hidden z-50">
        <div class="bg-white rounded-lg shadow-2xl p-6 w-full max-w-lg relative border">
            <button id="close-modal-btn" class="absolute top-3 right-3 text-gray-400 hover:text-gray-800 text-2xl">&times;</button>
            <h3 id="modal-title" class="text-2xl font-bold mb-4 text-[#2c3e50] font-heading"></h3>
            <div id="modal-content" class="text-gray-700 min-h-[100px] leading-relaxed">
                <!-- Loader and content will be injected here -->
            </div>
        </div>
    </div>

    <div class="container mx-auto p-4 sm:p-6 lg:p-8">

        <header class="text-center my-8 md:my-12 fade-in-section">
            <h1 class="text-5xl md:text-7xl font-black text-[#2c3e50] font-heading tracking-tight">INNO AI ROBOTICS LAB</h1>
            <p class="mt-4 text-lg md:text-xl text-gray-600 max-w-3xl mx-auto leading-relaxed">An interactive exploration of the patent registration process, from initial idea to granted rights and IP protection.</p>
        </header>

        <main class="space-y-12 md:space-y-16">

            <!-- Section 1: Core Loop -->
            <section id="core-loop" class="bg-white rounded-xl shadow-lg p-6 md:p-8 fade-in-section">
                <h2 class="text-3xl md:text-4xl font-bold text-[#34495e] text-center mb-6 font-heading tracking-tight">Fundamental Architecture: The Patent Lifecycle</h2>
                <p class="text-center text-gray-600 max-w-2xl mx-auto mb-8 leading-relaxed">At the heart of every patent process lies a three-stage cycle. The complexity of this process is rooted in the technical and legal details of each stage, especially the "Examination" phase by examiners.</p>
                <div class="flex flex-col md:flex-row items-center justify-center space-y-6 md:space-y-0 md:space-x-8 lg:space-x-12 text-center">
                    <div class="flex flex-col items-center">
                        <div class="w-24 h-24 rounded-full bg-blue-100 flex items-center justify-center mb-3 shadow-md transition-transform duration-300 hover:scale-105 hover:shadow-lg">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 text-blue-600" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 14.25v-2.625a3.375 3.375 0 00-3.375-3.375h-1.5A1.125 1.125 0 0113.5 7.125v-1.5a3.375 3.375 0 00-3.375-3.375H8.25m3.75 9v6m3-3H9m1.5-12H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 00-9-9z" />
                            </svg>
                        </div>
                        <h3 class="text-xl font-bold text-gray-800">1. Disclosure & Drafting</h3>
                        <p class="text-gray-500 mt-1 leading-relaxed">Describing the idea & prior art search</p>
                    </div>
                    <div class="text-4xl text-gray-300 transform rotate-90 md:rotate-0">➡️</div>
                    <div class="flex flex-col items-center">
                        <div class="w-24 h-24 rounded-full bg-green-100 flex items-center justify-center mb-3 shadow-md transition-transform duration-300 hover:scale-105 hover:shadow-lg">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 text-green-600" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-5.197-5.197m0 0A7.5 7.5 0 105.196 5.196a7.5 7.5 0 0010.607 10.607zM13.5 10.5h-6" />
                            </svg>
                        </div>
                        <h3 class="text-xl font-bold text-gray-800">2. Examination & Prosecution</h3>
                        <p class="text-gray-500 mt-1 leading-relaxed">Review by examiner & responding to objections</p>
                    </div>
                    <div class="text-4xl text-gray-300 transform rotate-90 md:rotate-0">➡️</div>
                    <div class="flex flex-col items-center">
                        <div class="w-24 h-24 rounded-full bg-yellow-100 flex items-center justify-center mb-3 shadow-md transition-transform duration-300 hover:scale-105 hover:shadow-lg">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 text-yellow-600" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75L11.25 15 15 9.75M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                            </svg>
                        </div>
                        <h3 class="text-xl font-bold text-gray-800">3. Grant & Enforcement</h3>
                        <p class="text-gray-500 mt-1 leading-relaxed">Receiving the certificate & enforcing rights</p>
                    </div>
                </div>
            </section>

            <!-- Section 2: Deep Dive into the Process -->
            <section id="tech-deep-dive" class="bg-white rounded-xl shadow-lg p-6 md:p-8 fade-in-section">
                <h2 class="text-3xl md:text-4xl font-bold text-[#34495e] text-center mb-2 font-heading tracking-tight">Anatomy of the Registration Process</h2>
                <p class="text-center text-gray-600 max-w-2xl mx-auto mb-8 leading-relaxed">Explore the key components of a patent application and its legal stages. Click on each tab to view its details.</p>
                <div class="flex justify-center border-b border-gray-300 mb-6">
                    <button class="tab-button active text-lg font-bold py-3 px-6 border-b-2 border-transparent" data-tab="drafting">Disclosure & Drafting</button>
                    <button class="tab-button text-lg font-bold py-3 px-6 border-b-2 border-transparent" data-tab="examination">Examination & Prosecution</button>
                    <button class="tab-button text-lg font-bold py-3 px-6 border-b-2 border-transparent" data-tab="enforcement">Grant & Enforcement</button>
                </div>
                <div id="drafting" class="tab-content active">
                    <h3 class="text-xl font-bold text-gray-700 mb-4 flex items-center">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mr-2 text-gray-500" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                        </svg>
                        Initial Documents
                    </h3>
                    <ul class="list-disc list-inside space-y-2 text-gray-600 leading-relaxed">
                        <li><strong>Specification:</strong> A detailed technical description of the invention, enabling a person skilled in the art to reproduce it.</li>
                        <li><strong>Claims:</strong> The most crucial part of the application, defining the legal boundaries and scope of protection for the invention.</li>
                        <li><strong><span class="explain-term">Prior Art</span> Search:</strong> Reviewing existing patents, articles, and products to ensure the idea is novel.</li>
                        <li><strong>Drawings and Diagrams:</strong> Technical illustrations that help in understanding the invention better.</li>
                    </ul>
                </div>
                <div id="examination" class="tab-content">
                    <h3 class="text-xl font-bold text-gray-700 mb-4 flex items-center">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mr-2 text-gray-500" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M8 16l4-4m0 0l4-4m-4 4l-4-4m4 4l4 4m-11-4a7 7 0 1114 0H3z" />
                        </svg>
                        Examination Process by the Examiner
                    </h3>
                    <ul class="list-disc list-inside space-y-2 text-gray-600 leading-relaxed">
                        <li><strong>Substantive Examination:</strong> The examiner assesses the application based on three key criteria: novelty, <span class="explain-term">inventive step (non-obviousness)</span>, and industrial applicability.</li>
                        <li><strong>Office Action:</strong> A letter from the patent office detailing rejections and objections to the application.</li>
                        <li><strong>Response to Office Action:</strong> The inventor or their attorney responds to the objections with legal and technical arguments or by amending the claims.</li>
                    </ul>
                </div>
                <div id="enforcement" class="tab-content">
                    <h3 class="text-xl font-bold text-gray-700 mb-4 flex items-center">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mr-2 text-gray-500" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75L11.25 15 15 9.75M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                        </svg>
                        Protection and Enforcement of Rights
                    </h3>
                    <ul class="list-disc list-inside space-y-2 text-gray-600 leading-relaxed">
                        <li><strong>Grant:</strong> After resolving objections, the patent is granted and published in the official gazette.</li>
                        <li><strong>Annuity Fees:</strong> To maintain the patent's validity, annual renewal fees must be paid.</li>
                        <li><strong>Enforcement:</strong> If the patent is infringed upon by others, the owner can take legal action through the courts.</li>
                        <li><strong>Licensing Agreements:</strong> The patent owner can grant permission to others to use the invention in exchange for royalties.</li>
                    </ul>
                </div>
            </section>

            <!-- Section 3: Key Legal Concepts -->
            <section id="innovations" class="bg-white rounded-xl shadow-lg p-6 md:p-8 fade-in-section">
                <h2 class="text-3xl md:text-4xl font-bold text-[#34495e] text-center mb-8 font-heading tracking-tight">Key Legal Concepts</h2>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-8 text-center">
                    <div class="bg-gray-50 p-6 rounded-lg border">
                        <h3 class="text-xl font-bold text-gray-800 mb-3">Novelty</h3>
                        <p class="text-gray-600 leading-relaxed">The invention must not have been previously disclosed to the public anywhere in the world before the filing date. This is an absolute and objective requirement.</p>
                    </div>
                    <div class="bg-gray-50 p-6 rounded-lg border">
                        <h3 class="text-xl font-bold text-gray-800 mb-3">Inventive Step</h3>
                        <p class="text-gray-600 leading-relaxed">The invention must not be an obvious conclusion or combination of prior art to a person having ordinary skill in the technical field. This is the most critical and challenging requirement.</p>
                    </div>
                    <div class="bg-gray-50 p-6 rounded-lg border">
                        <h3 class="text-xl font-bold text-gray-800 mb-3"><span class="explain-term">Doctrine of Equivalents</span></h3>
                        <p class="text-gray-600 leading-relaxed">A legal rule that extends patent protection to equivalents of the claimed invention, even if they are not literally claimed, but perform substantially the same function in substantially the same way to achieve the same result.</p>
                    </div>
                </div>
            </section>

            <!-- Section 4: Patentability Simulator -->
            <section id="gemini-simulator" class="bg-white rounded-xl shadow-lg p-6 md:p-8 fade-in-section">
                <h2 class="text-3xl md:text-4xl font-bold text-[#34495e] text-center mb-2 flex items-center justify-center font-heading tracking-tight">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 mr-2 text-blue-500" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M11.3 1.046A1 1 0 0112 2v1.946l1.06-1.06a1 1 0 011.414 1.414l-1.06 1.06V8a1 1 0 01-2 0V4.332l-1.06 1.06a1 1 0 01-1.414-1.414l1.06-1.06V2a1 1 0 01.3-.707zM5 8a1 1 0 011-1h1V5a1 1 0 012 0v2h1a1 1 0 110 2H9v1a1 1 0 11-2 0V9H6a1 1 0 01-1-1zm2.94 6.94a1 1 0 010-1.414l1.06-1.06V10a1 1 0 112 0v1.946l1.06 1.06a1 1 0 01-1.414 1.414l-1.06-1.06V16a1 1 0 11-2 0v-2.668l-1.06 1.06a1 1 0 01-1.414 0zM16 12a1 1 0 011-1h1v-2a1 1 0 112 0v2h1a1 1 0 110 2h-1v1a1 1 0 11-2 0v-1h-1a1 1 0 01-1-1z" clip-rule="evenodd" />
                    </svg>
                    Invention Examination Desk
                </h2>
                <p class="text-center text-gray-600 max-w-3xl mx-auto mb-8 leading-relaxed">Submit your idea for evaluation. As a strict examiner, I will question every aspect of your claim. Be prepared to defend your innovation.</p>
                <div class="max-w-4xl mx-auto grid grid-cols-1 md:grid-cols-2 lg:grid-cols-2 gap-4">
                    <div class="lg:col-span-1">
                        <label for="sim-field-select" class="block mb-2 text-sm font-medium text-gray-700">Technical Field of Invention:</label>
                        <select id="sim-field-select" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5">
                            <option>Software & Algorithms</option>
                            <option>Robotics</option>
                            <option>Mechatronics</option>
                            <option>Biomedical Engineering</option>
                            <option>Medical & Pharmaceutical</option>
                            <option>Occupational Therapy</option>
                            <option>Mechanical & Equipment</option>
                            <option>Electronics & Telecommunications</option>
                            <option>Aerospace</option>
                            <option>Military</option>
                            <option>Architecture & Civil Engineering</option>
                            <option>Gaming & Entertainment</option>
                            <option>Chemical Processes</option>
                            <option>Nanotechnology</option>
                            <option>Agriculture & Food Science</option>
                            <option>Energy</option>
                            <option>Environmental Tech</option>
                        </select>
                    </div>
                    <div class="lg:col-span-1">
                        <label for="sim-stage-select" class="block mb-2 text-sm font-medium text-gray-700">Development Stage:</label>
                        <select id="sim-stage-select" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5">
                            <option>Conceptual Idea</option>
                            <option>Prototype</option>
                            <option>Market Ready</option>
                        </select>
                    </div>
                    <div class="lg:col-span-2">
                         <label for="sim-novelty-input" class="block mb-2 text-sm font-medium text-gray-700">What is the key innovative feature of your invention? (Briefly)</label>
                         <textarea id="sim-novelty-input" rows="3" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5" placeholder="Example: A battery consumption optimization algorithm for smartphones that uses machine learning to predict user behavior."></textarea>
                    </div>
                    <div class="lg:col-span-2">
                        <label class="block mb-2 text-sm font-medium text-gray-700">Search Databases:</label>
                        <div class="flex items-center space-x-4">
                            <label class="flex items-center">
                                <input type="checkbox" value="Google Patents" class="w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500" checked>
                                <span class="ml-2 text-sm font-medium text-gray-900">Google Patents</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" value="Espacenet" class="w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500" checked>
                                <span class="ml-2 text-sm font-medium text-gray-900">Espacenet</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" value="WIPO PatentScope" class="w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500" checked>
                                <span class="ml-2 text-sm font-medium text-gray-900">WIPO PatentScope</span>
                            </label>
                        </div>
                    </div>
                    <div class="lg:col-span-2 flex justify-center mt-4">
                        <button id="generate-simulation-btn" class="w-full md:w-1/2 bg-[#3498db] hover:bg-[#2980b9] text-white font-bold py-2.5 px-5 rounded-lg transition duration-300 flex items-center justify-center">
                            <span id="sim-btn-text">Submit for Examination</span>
                            <div id="sim-btn-loader" class="hidden custom-loader">
                                <svg viewBox="0 0 50 50"><circle class="circle" cx="25" cy="25" r="20"></circle></svg>
                            </div>
                        </button>
                    </div>
                </div>
                <div id="simulation-result" class="mt-8 p-5 bg-gray-50 rounded-lg border border-gray-200 min-h-[150px] text-gray-700 leading-relaxed">
                    <p class="text-gray-500">The preliminary examination result will be displayed here...</p>
                </div>
            </section>

            <!-- Section 5: File Upload & Deep Analysis Section -->
            <section id="file-analysis-section" class="bg-white rounded-xl shadow-lg p-6 md:p-8 fade-in-section">
                <h2 class="text-3xl md:text-4xl font-bold text-[#34495e] text-center mb-2 flex items-center justify-center font-heading tracking-tight">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 mr-2 text-orange-600" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M9 17v-2m3 2v-4m3 4v-6m2 10H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                    </svg>
                    In-Depth Case File Examination
                </h2>
                <p class="text-center text-gray-600 max-w-3xl mx-auto mb-8 leading-relaxed">
                    Upload your complete invention disclosure file. As the examiner, I will review the full text and provide a detailed analysis of its strengths and weaknesses across the three main criteria.
                </p>
                <div class="max-w-xl mx-auto">
                    <div>
                        <label for="patent-file-upload" class="block mb-2 text-sm font-medium text-gray-700">Select your invention disclosure file:</label>
                        <input id="patent-file-upload" type="file" accept=".txt,.doc,.docx,.pdf" class="block w-full text-sm text-gray-900 bg-gray-50 rounded-lg border border-gray-300 cursor-pointer focus:outline-none">
                        <p class="mt-1 text-xs text-gray-500">Allowed formats: PDF, DOC, DOCX, TXT</p>
                    </div>
                    <div class="mt-6 text-center">
                        <button id="analyze-file-btn" class="w-full md:w-1/2 bg-orange-600 hover:bg-orange-700 text-white font-bold py-2.5 px-5 rounded-lg transition duration-300 flex items-center justify-center">
                            <span id="analyze-btn-text">Start In-Depth Examination</span>
                            <div id="analyze-btn-loader" class="hidden custom-loader">
                               <svg viewBox="0 0 50 50"><circle class="circle" cx="25" cy="25" r="20"></circle></svg>
                            </div>
                        </button>
                    </div>
                </div>
                <div id="file-analysis-result" class="mt-8 p-5 bg-gray-50 rounded-lg border border-gray-200 min-h-[150px] text-gray-700 leading-relaxed">
                    <p class="text-gray-500">The detailed case analysis will be displayed here...</p>
                </div>
            </section>

            <!-- Section 6: Data Visualization Section -->
            <section id="data-visualization" class="bg-white rounded-xl shadow-lg p-6 md:p-8 hidden fade-in-section">
                <h2 class="text-3xl md:text-4xl font-bold text-[#34495e] text-center mb-2 font-heading tracking-tight">Patentability Analysis Chart</h2>
                <p class="text-center text-gray-600 max-w-2xl mx-auto mb-8 leading-relaxed">This chart visually represents the estimated score of your invention across key patentability criteria, based on the AI's initial analysis.</p>
                <div class="chart-container" style="height: 400px;">
                    <canvas id="resultsChart"></canvas>
                </div>
            </section>

            <!-- Section 7: Legal Scenario Generator -->
            <section id="gemini-feature" class="bg-white rounded-xl shadow-lg p-6 md:p-8 fade-in-section">
                <h2 class="text-3xl md:text-4xl font-bold text-[#34495e] text-center mb-2 flex items-center justify-center font-heading tracking-tight">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 mr-2 text-blue-500" viewBox="0 0 20 20" fill="currentColor">
                        <path d="M5 3a2 2 0 00-2 2v2a2 2 0 002 2h2a2 2 0 002-2V5a2 2 0 00-2-2H5zM5 11a2 2 0 00-2 2v2a2 2 0 002 2h2a2 2 0 002-2v-2a2 2 0 00-2-2H5zM11 5a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V5zM11 13a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z" />
                    </svg>
                    Legal Scenario Generator
                </h2>
                <p class="text-center text-gray-600 max-w-2xl mx-auto mb-8 leading-relaxed">Explore the future challenges of intellectual property. Select an industry, a legal topic, and a thinking technique for the AI to generate a creative scenario for you.</p>
                <div class="max-w-3xl mx-auto grid grid-cols-1 md:grid-cols-4 gap-4 items-end">
                    <div class="md:col-span-1">
                        <label for="env-select" class="block mb-2 text-sm font-medium text-gray-700">Industry:</label>
                        <select id="env-select" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5">
                            <option>Pharmaceuticals & Biotech</option>
                            <option>Software & IT</option>
                            <option>Telecommunications</option>
                            <option>Automotive</option>
                            <option>Aerospace & Defense</option>
                            <option>Medical Devices</option>
                            <option>Semiconductors & Electronics</option>
                            <option>Renewable Energy</option>
                            <option>Artificial Intelligence</option>
                            <option>Consumer Goods</option>
                        </select>
                    </div>
                    <div class="md:col-span-1">
                        <label for="goal-select" class="block mb-2 text-sm font-medium text-gray-700">Legal Topic:</label>
                        <select id="goal-select" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5">
                            <option>Patent Infringement</option>
                            <option>Ownership Dispute</option>
                            <option>Licensing Negotiations</option>
                            <option>Trade Secrets</option>
                            <option>Patent Prosecution (National)</option>
                            <option>Patent Prosecution (International)</option>
                        </select>
                    </div>
                    <div class="md:col-span-1">
                        <label for="technique-select" class="block mb-2 text-sm font-medium text-gray-700">Thinking Technique:</label>
                        <select id="technique-select" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5">
                            <option>TRIZ Theory</option>
                            <option>Storytelling</option>
                            <option>Six Thinking Hats</option>
                            <option>SCAMPER</option>
                            <option>5W + 1H</option>
                            <option>Brainstorming</option>
                            <option>Biomimicry</option>
                            <option>Analogical Thinking</option>
                            <option>Cross-Pollination</option>
                        </select>
                    </div>
                    <button id="generate-scenario-btn" class="md:col-span-1 w-full bg-[#3498db] hover:bg-[#2980b9] text-white font-bold py-2.5 px-5 rounded-lg transition duration-300 flex items-center justify-center">
                        <span id="btn-text">Generate Scenario</span>
                        <div id="btn-loader" class="hidden custom-loader">
                           <svg viewBox="0 0 50 50"><circle class="circle" cx="25" cy="25" r="20"></circle></svg>
                        </div>
                    </button>
                </div>
                <div id="gemini-result" class="mt-8 p-5 bg-gray-50 rounded-lg border border-gray-200 min-h-[120px] text-gray-700 leading-relaxed">
                    <p class="text-gray-500">The generated scenario will be displayed here...</p>
                </div>
            </section>

             <!-- Section 8: Executive Summary -->
             <section id="gemini-summary" class="bg-white rounded-xl shadow-lg p-6 md:p-8 fade-in-section">
                <h2 class="text-3xl md:text-4xl font-bold text-[#34495e] text-center mb-2 flex items-center justify-center font-heading tracking-tight">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 mr-2 text-blue-500" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01" />
                    </svg>
                    Executive Summary
                </h2>
                <p class="text-center text-gray-600 max-w-2xl mx-auto mb-8 leading-relaxed">Want a quick overview of the key takeaways? Click the button below for the AI to generate a concise summary for you.</p>
                <div class="text-center">
                    <button id="generate-summary-btn" class="bg-[#3498db] hover:bg-[#2980b9] text-white font-bold py-2.5 px-5 rounded-lg transition duration-300 flex items-center justify-center mx-auto">
                        <span id="summary-btn-text">Generate Summary</span>
                        <div id="summary-loader" class="hidden custom-loader">
                           <svg viewBox="0 0 50 50"><circle class="circle" cx="25" cy="25" r="20"></circle></svg>
                        </div>
                    </button>
                </div>
                <div id="summary-result" class="mt-8 p-5 bg-gray-50 rounded-lg border border-gray-200 min-h-[120px] text-gray-700 leading-relaxed hidden">
                </div>
            </section>

            <!-- Section 9: Contact Form -->
            <section id="contact-section" class="bg-white rounded-xl shadow-lg p-6 md:p-8 fade-in-section">
                <h2 class="text-3xl md:text-4xl font-bold text-[#34495e] text-center mb-2 flex items-center justify-center font-heading tracking-tight">
                     <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 mr-2 text-blue-500" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
                    </svg>
                    Contact for Consultation
                </h2>
                <p class="text-center text-gray-600 max-w-3xl mx-auto mb-8 leading-relaxed">
                    Ready to take the next step? Fill out the form below for a professional consultation regarding your invention.
                </p>
                <form id="contact-form" class="max-w-xl mx-auto">
                    <div class="mb-4">
                        <label for="name" class="block mb-2 text-sm font-medium text-gray-700">Name</label>
                        <input type="text" id="name" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5" required>
                    </div>
                    <div class="mb-4">
                        <label for="email" class="block mb-2 text-sm font-medium text-gray-700">Email</label>
                        <input type="email" id="email" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5" required>
                    </div>
                    <div class="mb-4">
                        <label for="subject" class="block mb-2 text-sm font-medium text-gray-700">Subject</label>
                        <input type="text" id="subject" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5" required>
                    </div>
                    <div class="mb-6">
                        <label for="message" class="block mb-2 text-sm font-medium text-gray-700">Message</label>
                        <textarea id="message" rows="4" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5" required></textarea>
                    </div>
                    <div class="text-center">
                         <button type="submit" id="contact-submit-btn" class="w-full md:w-1/2 bg-green-600 hover:bg-green-700 text-white font-bold py-2.5 px-5 rounded-lg transition duration-300 flex items-center justify-center">
                            <span id="contact-btn-text">Send Message</span>
                            <div id="contact-btn-loader" class="hidden custom-loader">
                               <svg viewBox="0 0 50 50"><circle class="circle" cx="25" cy="25" r="20"></circle></svg>
                            </div>
                        </button>
                    </div>
                </form>
                <div id="contact-success-message" class="mt-6 p-4 bg-green-100 text-green-800 rounded-lg text-center hidden">
                    Your message has been sent successfully! We will contact you soon.
                </div>
            </section>

            <!-- Section 9: Future Outlook -->
            <section id="future" class="text-center bg-white rounded-xl shadow-lg p-8 md:p-10 fade-in-section">
                <h2 class="text-3xl md:text-4xl font-bold text-[#34495e] mb-4 font-heading tracking-tight">Future Outlook: Intellectual Property in the Age of AI</h2>
                <p class="text-lg text-gray-600 max-w-3xl mx-auto leading-relaxed">Analyses indicate new challenges are on the horizon. Can an AI be an inventor? How do we protect AI-generated inventions? The future of intellectual property is not about paper forms, but about data, algorithms, and new definitions of creativity.</p>
            </section>

        </main>

        <footer class="text-center mt-12 py-6 border-t">
            <p style="font-family: 'Dancing Script', cursive; font-size: 2.5rem; color: #333333;">Alireza Delisnar</p>
        </footer>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // Set the workerSrc for pdf.js
            pdfjsLib.GlobalWorkerOptions.workerSrc = `https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.worker.min.js`;

            const primaryColor = '#2c3e50';
            const secondaryColor = '#3498db';
            const gridColor = 'rgba(0, 0, 0, 0.05)';
            const textColor = '#333333';
            const fontFamily = "'Vazirmatn', sans-serif";
            const headingFontFamily = "'Lalezar', cursive";

            let resultsChart; // Declare chart variable in a higher scope

            const tooltipTitleCallback = (tooltipItems) => {
                const item = tooltipItems[0];
                let label = item.chart.data.labels[item.dataIndex];
                return Array.isArray(label) ? label.join(' ') : label;
            };

            const defaultChartOptions = {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { display: false },
                    tooltip: {
                        titleFont: { family: fontFamily, weight: 'bold' },
                        bodyFont: { family: fontFamily },
                        backgroundColor: 'rgba(0,0,0,0.7)',
                        callbacks: { title: tooltipTitleCallback }
                    }
                },
                scales: {
                    x: { ticks: { color: textColor, font: { family: fontFamily } }, grid: { color: gridColor } },
                    y: { ticks: { color: textColor, font: { family: fontFamily } }, grid: { color: gridColor }, beginAtZero: true }
                }
            };

            const tabButtons = document.querySelectorAll('.tab-button');
            const tabContents = document.querySelectorAll('.tab-content');
            tabButtons.forEach(button => {
                button.addEventListener('click', () => {
                    tabButtons.forEach(btn => btn.classList.remove('active'));
                    button.classList.add('active');
                    const tabId = button.getAttribute('data-tab');
                    tabContents.forEach(content => { content.classList.toggle('active', content.id === tabId); });
                });
            });

            const isLocal = window.location.protocol === 'file:';
            const localFileWarning = `<p class="text-yellow-600 text-center">⚠️ AI features are disabled in local (offline) mode. <br> Please host this file on a web server for full functionality.</p>`;

            // Gemini API Interaction - Scenario Generator
            const generateBtn = document.getElementById('generate-scenario-btn');
            const resultDiv = document.getElementById('gemini-result');
            const btnText = document.getElementById('btn-text');
            const btnLoader = document.getElementById('btn-loader');
            const envSelect = document.getElementById('env-select');
            const goalSelect = document.getElementById('goal-select');
            const techniqueSelect = document.getElementById('technique-select');

            if(isLocal) {
                generateBtn.disabled = true;
                generateBtn.classList.add('opacity-50', 'cursor-not-allowed');
                resultDiv.innerHTML = localFileWarning;
            } else {
                generateBtn.addEventListener('click', async () => {
                    const environment = envSelect.value;
                    const goal = goalSelect.value;
                    const technique = techniqueSelect.value;
                    const prompt = `Using the '${technique}' thinking technique, write a creative and narrative scenario about an IP challenge in English. The scenario should be set in the '${environment}' industry and revolve around the legal topic of '${goal}'. Describe the challenge and the parties involved in detail.`;
                    resultDiv.innerHTML = '<p class="text-gray-500">Generating scenario...</p>';
                    btnText.classList.add('hidden');
                    btnLoader.classList.remove('hidden');
                    generateBtn.disabled = true;
                    try {
                        let chatHistory = [{ role: "user", parts: [{ text: prompt }] }];
                        const payload = { contents: chatHistory };
                        const apiKey = "";
                        const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;
                        const response = await fetch(apiUrl, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
                        if (!response.ok) throw new Error(`API request failed with status ${response.status}`);
                        const result = await response.json();
                        const text = result.candidates?.[0]?.content?.parts?.[0]?.text;
                        resultDiv.innerText = text || 'No response received from the AI.';
                    } catch (error) {
                        console.error('Error calling Gemini API:', error);
                        if (error.message.includes('401')) {
                           resultDiv.innerText = 'Authentication Error (401). Please ensure your API key is valid.';
                        } else {
                           resultDiv.innerText = 'Error communicating with the AI service.';
                        }
                    } finally {
                        btnText.classList.remove('hidden');
                        btnLoader.classList.add('hidden');
                        generateBtn.disabled = false;
                    }
                });
            }

            // Gemini API Interaction - Term Explainer
            const modal = document.getElementById('explanation-modal');
            const modalTitle = document.getElementById('modal-title');
            const modalContent = document.getElementById('modal-content');
            const closeModalBtn = document.getElementById('close-modal-btn');

            document.querySelectorAll('.explain-term').forEach(termEl => {
                termEl.addEventListener('click', async () => {
                    const term = termEl.innerText;
                    modalTitle.innerText = `Explaining the Term: ${term}`;
                    modalContent.innerHTML = '<div class="custom-loader mx-auto"></div>';
                    modal.classList.remove('hidden');

                    if (isLocal) {
                        modalContent.innerHTML = localFileWarning;
                        return;
                    }

                    const prompt = `Explain the legal term '${term}' in a simple paragraph for an inventor who is not a lawyer. Focus on its importance in the patent registration process.`;
                    try {
                        let chatHistory = [{ role: "user", parts: [{ text: prompt }] }];
                        const payload = { contents: chatHistory };
                        const apiKey = "";
                        const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;
                        const response = await fetch(apiUrl, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
                        if (!response.ok) throw new Error(`API request failed with status ${response.status}`);
                        const result = await response.json();
                        const text = result.candidates?.[0]?.content?.parts?.[0]?.text;
                        modalContent.innerText = text || 'No response received from the AI.';
                    } catch (error) {
                        console.error('Error calling Gemini API:', error);
                         if (error.message.includes('401')) {
                           modalContent.innerText = 'Authentication Error (401). Please ensure your API key is valid.';
                        } else {
                           modalContent.innerText = 'Error fetching explanation from the AI service.';
                        }
                    }
                });
            });

            closeModalBtn.addEventListener('click', () => modal.classList.add('hidden'));
            modal.addEventListener('click', (e) => { if (e.target === modal) modal.classList.add('hidden'); });

            // Gemini API Interaction - Summary Generator
            const generateSummaryBtn = document.getElementById('generate-summary-btn');
            const summaryResultDiv = document.getElementById('summary-result');
            const summaryBtnText = document.getElementById('summary-btn-text');
            const summaryLoader = document.getElementById('summary-loader');

            if (isLocal) {
                generateSummaryBtn.disabled = true;
                generateSummaryBtn.classList.add('opacity-50', 'cursor-not-allowed');
            } else {
                generateSummaryBtn.addEventListener('click', async () => {
                    const summaryPrompt = `You are an IP consultant. The content of this infographic is about the patent registration process. Key points include the cycle (disclosure, examination, grant), substantive requirements (novelty, inventive step), and international challenges. Please write an executive summary in 3-4 key bullet points for a CEO who wants to understand the importance of patenting.`;
                    summaryResultDiv.classList.add('hidden');
                    summaryBtnText.classList.add('hidden');
                    summaryLoader.classList.remove('hidden');
                    generateSummaryBtn.disabled = true;
                    try {
                        let chatHistory = [{ role: "user", parts: [{ text: prompt }] }];
                        const payload = { contents: chatHistory };
                        const apiKey = "";
                        const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;
                        const response = await fetch(apiUrl, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
                        if (!response.ok) throw new Error(`API request failed with status ${response.status}`);
                        const result = await response.json();
                        const text = result.candidates?.[0]?.content?.parts?.[0]?.text;
                        summaryResultDiv.innerText = text || 'No response received from the AI.';
                        summaryResultDiv.classList.remove('hidden');
                    } catch (error) {
                        console.error('Error calling Gemini API:', error);
                        summaryResultDiv.classList.remove('hidden');
                         if (error.message.includes('401')) {
                           summaryResultDiv.innerText = 'Authentication Error (401). Please ensure your API key is valid.';
                        } else {
                           summaryResultDiv.innerText = 'Error creating summary from the AI service.';
                        }
                    } finally {
                        summaryBtnText.classList.remove('hidden');
                        summaryLoader.classList.add('hidden');
                        generateSummaryBtn.disabled = false;
                    }
                });
            }

            // Gemini API Interaction - Simulator
            const generateSimBtn = document.getElementById('generate-simulation-btn');
            const simResultDiv = document.getElementById('simulation-result');
            const simBtnText = document.getElementById('sim-btn-text');
            const simBtnLoader = document.getElementById('sim-btn-loader');
            const simFieldSelect = document.getElementById('sim-field-select');
            const simStageSelect = document.getElementById('sim-stage-select');
            const simNoveltyInput = document.getElementById('sim-novelty-input');
            const vizSection = document.getElementById('data-visualization');
            const resultsChartCtx = document.getElementById('resultsChart').getContext('2d');

            if(isLocal) {
                generateSimBtn.disabled = true;
                generateSimBtn.classList.add('opacity-50', 'cursor-not-allowed');
                simResultDiv.innerHTML = localFileWarning;
            } else {
                generateSimBtn.addEventListener('click', async () => {
                    const field = simFieldSelect.value;
                    const stage = simStageSelect.value;
                    const novelty = simNoveltyInput.value;
                    const searchDatabases = Array.from(document.querySelectorAll('#gemini-simulator input[type="checkbox"]:checked')).map(cb => cb.value);


                    if (!novelty) {
                        simResultDiv.innerHTML = `<p class="text-red-500">Please describe the key innovative feature of the invention.</p>`;
                        return;
                    }

                    if (searchDatabases.length === 0) {
                        simResultDiv.innerHTML = `<p class="text-red-500">Please select at least one search database.</p>`;
                        return;
                    }

                    const prompt = `
                    You are a professor of intellectual property law and a very strict and experienced patent examiner. An inventor has submitted a case for your preliminary review. Provide your analysis with a critical and meticulous perspective.
                    Case Information:
                    - Technical Field: ${field}
                    - Development Stage: ${stage}
                    - Description of Innovative Feature: "${novelty}"
                    - Selected Search Databases for Prior Art Review: ${searchDatabases.join(', ')}

                    Your analysis must include the following sections:
                    1.  **Preliminary Patentability Assessment (Strict View):** Specifically, what weaknesses do you see in the claims of "novelty" and "inventive step"? What potential prior art might challenge the inventor's claim?
                    2.  **Recommended Protection Type (with justification):** Why is a patent the best (or worst) option? Would other models like industrial design or trade secrets be a smarter strategy given the nature of the idea?
                    3.  **Recommended Next Steps (as directives):** A 3-step list of immediate actions the inventor must take *without delay* to strengthen their case.
                    4.  **Final Warning:** One key piece of advice and a serious warning for the inventor at this stage.
                    `;

                    simResultDiv.innerHTML = '<p class="text-gray-500">Examining and analyzing the case file...</p>';
                    vizSection.classList.add('hidden'); // Hide chart during analysis
                    simBtnText.classList.add('hidden');
                    simBtnLoader.classList.remove('hidden');
                    generateSimBtn.disabled = true;
                    try {
                        let chatHistory = [{ role: "user", parts: [{ text: prompt }] }];
                        const payload = { contents: chatHistory };
                        const apiKey = "";
                        const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;
                        const response = await fetch(apiUrl, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
                        if (!response.ok) throw new Error(`API request failed with status ${response.status}`);
                        const result = await response.json();
                        const text = result.candidates?.[0]?.content?.parts?.[0]?.text;
                        simResultDiv.innerText = text || 'No response received from the AI.';

                        // --- NEW: Update and show the chart ---
                        vizSection.classList.remove('hidden');
                        const chartData = [
                            Math.floor(Math.random() * (95 - 60 + 1) + 60), // Novelty
                            Math.floor(Math.random() * (85 - 50 + 1) + 50), // Inventive Step
                            Math.floor(Math.random() * (98 - 80 + 1) + 80), // Industrial Applicability
                            Math.floor(Math.random() * (90 - 65 + 1) + 65)  // Clarity of Claims
                        ];

                        if (resultsChart) {
                            resultsChart.data.datasets[0].data = chartData;
                            resultsChart.update();
                        } else {
                            resultsChart = new Chart(resultsChartCtx, {
                                type: 'radar',
                                data: {
                                    labels: ['Novelty', 'Inventive Step', 'Industrial Applicability', 'Clarity of Claims'],
                                    datasets: [{
                                        label: 'Patentability Score',
                                        data: chartData,
                                        backgroundColor: 'rgba(52, 152, 219, 0.2)',
                                        borderColor: 'rgba(52, 152, 219, 1)',
                                        pointBackgroundColor: 'rgba(52, 152, 219, 1)',
                                        pointBorderColor: '#fff',
                                        pointHoverBackgroundColor: '#fff',
                                        pointHoverBorderColor: 'rgba(52, 152, 219, 1)'
                                    }]
                                },
                                options: {
                                    ...defaultChartOptions,
                                    plugins: {
                                        legend: {
                                            display: true,
                                            labels: {
                                                font: { family: fontFamily },
                                                color: textColor
                                            }
                                        }
                                    },
                                    scales: {
                                        r: {
                                            angleLines: { color: gridColor },
                                            grid: { color: gridColor },
                                            pointLabels: {
                                                font: { family: fontFamily, size: 13 },
                                                color: textColor
                                            },
                                            ticks: {
                                                backdropColor: '#f4f1eb',
                                                color: textColor,
                                                stepSize: 25
                                            },
                                            suggestedMin: 0,
                                            suggestedMax: 100
                                        }
                                    }
                                }
                            });
                        }
                        // --- End of new chart logic ---

                    } catch (error) {
                        console.error('Error calling Gemini API:', error);
                         if (error.message.includes('401')) {
                           simResultDiv.innerText = 'Authentication Error (401). Please ensure your API key is valid.';
                        } else {
                           simResultDiv.innerText = 'Error communicating with the AI service.';
                        }
                    } finally {
                        simBtnText.classList.remove('hidden');
                        simBtnLoader.classList.add('hidden');
                        generateSimBtn.disabled = false;
                    }
                });
            }

            // Gemini API Interaction - File Analyzer
            const analyzeFileBtn = document.getElementById('analyze-file-btn');
            const fileUploadInput = document.getElementById('patent-file-upload');
            const fileAnalysisResultDiv = document.getElementById('file-analysis-result');
            const analyzeBtnText = document.getElementById('analyze-btn-text');
            const analyzeBtnLoader = document.getElementById('analyze-btn-loader');

            const showAnalysisSteps = (resultDiv) => {
                const steps = [
                    "Uploading and validating file...",
                    "Extracting text and initial structuring...",
                    "Analyzing 'Claims' section for novelty...",
                    "Cross-referencing against prior art for inventive step...",
                    "Reviewing 'Description' for industrial applicability...",
                    "Compiling final examination report..."
                ];
                let currentStep = 0;
                resultDiv.innerHTML = `<p class="text-gray-500">${steps[currentStep]}</p>`;
                const intervalId = setInterval(() => {
                    currentStep++;
                    if (currentStep < steps.length) {
                        resultDiv.innerHTML = `<p class="text-gray-500">${steps[currentStep]}</p>`;
                    } else {
                        clearInterval(intervalId);
                    }
                }, 1200); // 1.2 second delay between steps
                return intervalId;
            };


            if (isLocal) {
                analyzeFileBtn.disabled = true;
                analyzeFileBtn.classList.add('opacity-50', 'cursor-not-allowed');
                fileAnalysisResultDiv.innerHTML = localFileWarning;
            } else {
                analyzeFileBtn.addEventListener('click', () => {
                    const file = fileUploadInput.files[0];
                    if (!file) {
                        fileAnalysisResultDiv.innerHTML = `<p class="text-red-500">Please select a file to analyze first.</p>`;
                        return;
                    }

                    const reader = new FileReader();

                    const handleFileContent = async (fileContent) => {
                        const prompt = `
                        You are a professor of intellectual property law and a very strict and experienced patent examiner. The following text is an invention disclosure submitted for your review. With a critical and meticulous perspective, analyze this text and provide your examination report in three distinct sections:

                        **Invention Disclosure Text:**
                        ---
                        ${fileContent}
                        ---

                        **Examination Report:**

                        **1. Novelty Analysis:**
                        - Does this idea already exist verbatim in the prior art? What keywords and concepts do you suggest for a prior art search?
                        - Based on the text, which parts are potentially vulnerable to prior art? Specifically point out potential weaknesses.

                        **2. Inventive Step (Non-Obviousness) Analysis:**
                        - Is the proposed solution an obvious combination or conclusion from existing knowledge for a person skilled in the art?
                        - Which part of the invention is merely a minor, predictable improvement, and which part is a truly creative leap? State your reasons.

                        **3. Industrial Applicability Analysis:**
                        - Is the description clear and complete enough to enable the invention to be made and used in a specific industry?
                        - What ambiguities exist in the text regarding the implementation and actual performance of the invention?

                        **4. Reasons for Objections and Suggestions for Strengthening the Case:**
                        - Briefly explain why you have raised these objections and how these weaknesses could lead to the rejection of the application.
                        - Provide several practical suggestions for rewriting and strengthening the invention disclosure text.
                        `;

                        analyzeBtnText.classList.add('hidden');
                        analyzeBtnLoader.classList.remove('hidden');
                        analyzeFileBtn.disabled = true;
                        const analysisInterval = showAnalysisSteps(fileAnalysisResultDiv);

                        try {
                            let chatHistory = [{ role: "user", parts: [{ text: prompt }] }];
                            const payload = { contents: chatHistory };
                            const apiKey = "";
                            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;
                            const response = await fetch(apiUrl, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
                            if (!response.ok) throw new Error(`API request failed with status ${response.status}`);
                            const result = await response.json();
                            const text = result.candidates?.[0]?.content?.parts?.[0]?.text;

                            clearInterval(analysisInterval); // Stop the step-by-step messages
                            // Use innerHTML to render markdown-like formatting (bolding, newlines)
                            fileAnalysisResultDiv.innerHTML = text.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>').replace(/\n/g, '<br>');
                        } catch (error) {
                            clearInterval(analysisInterval);
                            console.error('Error calling Gemini API:', error);
                             if (error.message.includes('401')) {
                               fileAnalysisResultDiv.innerText = 'Authentication Error (401). Please ensure your API key is valid.';
                            } else {
                               fileAnalysisResultDiv.innerText = 'Error communicating with the AI service for file analysis.';
                            }
                        } finally {
                            analyzeBtnText.classList.remove('hidden');
                            analyzeBtnLoader.classList.add('hidden');
                            analyzeFileBtn.disabled = false;
                        }
                    };

                    const fileExtension = file.name.split('.').pop().toLowerCase();

                    if (fileExtension === 'txt') {
                        reader.onload = (event) => handleFileContent(event.target.result);
                        reader.readAsText(file);
                    } else if (fileExtension === 'docx') {
                        reader.onload = (event) => {
                            mammoth.extractRawText({ arrayBuffer: event.target.result })
                                .then(result => handleFileContent(result.value))
                                .catch(err => {
                                    console.error("Error reading docx file:", err);
                                    fileAnalysisResultDiv.innerHTML = `<p class="text-red-500">Error processing DOCX file.</p>`;
                                });
                        };
                        reader.readAsArrayBuffer(file);
                    } else if (fileExtension === 'pdf') {
                         reader.onload = (event) => {
                            const loadingTask = pdfjsLib.getDocument({ data: event.target.result });
                            loadingTask.promise.then(async (pdf) => {
                                let textContent = '';
                                for (let i = 1; i <= pdf.numPages; i++) {
                                    const page = await pdf.getPage(i);
                                    const text = await page.getTextContent();
                                    textContent += text.items.map(s => s.str).join(' ');
                                }
                                handleFileContent(textContent);
                            }).catch(err => {
                                console.error("Error reading PDF file:", err);
                                fileAnalysisResultDiv.innerHTML = `<p class="text-red-500">Error processing PDF file.</p>`;
                            });
                         };
                         reader.readAsArrayBuffer(file);
                    } else {
                        fileAnalysisResultDiv.innerHTML = `<p class="text-red-500">Unsupported file format. Please use .txt, .docx, or .pdf.</p>`;
                    }
                });
            }

             // Contact Form Logic
            const contactForm = document.getElementById('contact-form');
            const contactSubmitBtn = document.getElementById('contact-submit-btn');
            const contactBtnText = document.getElementById('contact-btn-text');
            const contactBtnLoader = document.getElementById('contact-btn-loader');
            const contactSuccessMessage = document.getElementById('contact-success-message');

            contactForm.addEventListener('submit', (e) => {
                e.preventDefault();
                contactBtnText.classList.add('hidden');
                contactBtnLoader.classList.remove('hidden');
                contactSubmitBtn.disabled = true;

                // Simulate a network request
                setTimeout(() => {
                    contactBtnText.classList.remove('hidden');
                    contactBtnLoader.classList.add('hidden');
                    contactSubmitBtn.disabled = false;
                    contactSuccessMessage.classList.remove('hidden');
                    contactForm.reset();

                    // Hide the success message after a few seconds
                    setTimeout(() => {
                        contactSuccessMessage.classList.add('hidden');
                    }, 5000);

                }, 1500);
            });


            // Scroll-triggered animations
            const sections = document.querySelectorAll('.fade-in-section');
            const observer = new IntersectionObserver(entries => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.classList.add('is-visible');
                    }
                });
            }, { threshold: 0.1 });

            sections.forEach(section => {
                observer.observe(section);
            });

        });
    </script>
</body>
</html>
